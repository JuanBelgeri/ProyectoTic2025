<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración | PizzUM & BurgUM</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#FF0000', secondary: '#000000', success: '#16a34a' }
                }
            }
        };
    </script>
    <style>
        html, body { height:100%; margin:0; padding:0; }
        body { overflow-x:hidden; }
        .vanta-bg { position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:-1; opacity:0.15; pointer-events:none; }
        .step-dot { width: 14px; height: 14px; border-radius: 9999px; }
        .step-active { background: #FF0000; }
        .step-done   { background: #16a34a; }
        .step-pending{ background: #d1d5db; }
    </style>
</head>
<body class="bg-gray-50 font-sans">
<div id="vanta-bg" class="vanta-bg"></div>

<!-- Navegación -->
<nav class="bg-gradient-to-r from-primary to-secondary shadow-lg sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
            <div class="flex items-center">
                <div class="flex-shrink-0 flex items-center">
                    <i data-feather="heart" class="h-8 w-8 text-white"></i>
                    <span class="ml-2 text-xl font-bold text-white">PizzUM & BurgUM</span>
                </div>
            </div>
            <div class="hidden md:ml-6 md:flex md:items-center md:space-x-8">
                <a href="admin.html" class="text-white hover:text-gray-200 px-3 py-2 rounded-md text-sm font-medium">Administrador</a>
                <a href="builder.html" class="text-white hover:text-gray-200 px-3 py-2 rounded-md text-sm font-medium">Crea tu pedido</a>
                <a href="orden.html" class="text-white hover:text-gray-200 px-3 py-2 rounded-md text-sm font-medium">Seguir pedido</a>
                <a href="login.html" class="bg-white text-primary px-4 py-2 rounded-full font-bold hover:bg-gray-100 transition duration-300">Ingresar</a>
            </div>
        </div>
    </div>
</nav>

<!-- Contenido principal -->
<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <h1 class="text-3xl font-extrabold text-gray-900 mb-8 text-center">Panel de Administración</h1>

    <!-- Tabla de pedidos -->
    <div class="bg-white border-2 border-gray-100 rounded-lg shadow p-6 mb-10 overflow-x-auto">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Pedidos actuales</h2>
        <table class="min-w-full divide-y divide-gray-200 text-sm text-gray-700">
            <thead class="bg-gray-50">
            <tr>
                <th class="px-4 py-2 text-left font-semibold">ID</th>
                <th class="px-4 py-2 text-left font-semibold">Cliente</th>
                <th class="px-4 py-2 text-left font-semibold">Producto</th>
                <th class="px-4 py-2 text-left font-semibold">Estado</th>
                <th class="px-4 py-2 text-center font-semibold">Acción</th>
            </tr>
            </thead>
            <tbody id="orders-body" class="divide-y divide-gray-200"></tbody>
        </table>
    </div>

    <!-- Panel de estado visual -->
    <div id="status-panel" class="hidden bg-white border-2 border-gray-100 rounded-lg shadow p-6">
        <h3 class="text-lg font-bold text-gray-800 mb-4">Estado del pedido</h3>
        <ol class="hidden sm:flex items-center justify-between" id="steps-horizontal">
            <li class="flex-1 flex flex-col items-center"><div class="step-dot step-done mb-2"></div><div class="text-sm text-success font-medium">En cola</div><div class="w-full h-px bg-gray-200 mt-2"></div></li>
            <li class="flex-1 flex flex-col items-center"><div class="step-dot step-active mb-2"></div><div class="text-sm text-primary font-medium">En preparación</div><div class="w-full h-px bg-gray-200 mt-2"></div></li>
            <li class="flex-1 flex flex-col items-center"><div class="step-dot step-pending mb-2"></div><div class="text-sm text-gray-500 font-medium">En camino</div><div class="w-full h-px bg-gray-200 mt-2"></div></li>
            <li class="flex-1 flex flex-col items-center"><div class="step-dot step-pending mb-2"></div><div class="text-sm text-gray-500 font-medium">Entregado</div></li>
        </ol>
    </div>
</main>

<!-- Footer -->
<footer class="bg-gray-800">
    <div class="max-w-7xl mx-auto py-12 px-4 overflow-hidden sm:px-6 lg:px-8">
        <p class="text-center text-base text-gray-400">&copy; 2025 PizzUM & BurgUM. Todos los derechos reservados.</p>
    </div>
</footer>

<script>
    // --- Inicialización visual ---
    if (window.VANTA && VANTA.NET) {
        VANTA.NET({
            el: "#vanta-bg",
            mouseControls: true,
            touchControls: true,
            gyroControls: false,
            minHeight: 200.00,
            minWidth: 200.00,
            scale: 1.00,
            scaleMobile: 1.00,
            color: 0xff0000,
            backgroundColor: 0xffffff,
            points: 10.00,
            maxDistance: 20.00,
            spacing: 15.00
        });
    }
    if (window.feather) feather.replace();

    // --- Estados posibles ---
    const estados = ["En cola", "En preparación", "En camino", "Entregado"];

    // --- Cargar pedidos ---
    function cargarPedidos() {
        const orders = JSON.parse(localStorage.getItem('orders') || '[]');
        const tbody = document.getElementById('orders-body');
        tbody.innerHTML = '';

        orders.forEach((order, i) => {
            const tr = document.createElement('tr');
            const estadoActual = estados[order.statusIndex || 0];
            tr.innerHTML = `
          <td class="px-4 py-2">${order.id || i+1}</td>
          <td class="px-4 py-2">${order.user || 'Cliente'}</td>
          <td class="px-4 py-2">${order.items?.map(it => it.title || it.type).join(', ')}</td>
          <td class="px-4 py-2">${estadoActual}</td>
          <td class="px-4 py-2 text-center">
            <button class="bg-primary text-white px-3 py-1 rounded hover:bg-opacity-80 transition" onclick="cambiarEstado(${i})">Cambiar estado</button>
          </td>
        `;
            tbody.appendChild(tr);
        });
    }

    // --- Cambiar estado ---
    function cambiarEstado(index) {
        const orders = JSON.parse(localStorage.getItem('orders') || '[]');
        const order = orders[index];
        order.statusIndex = (order.statusIndex ?? 0) + 1;
        if (order.statusIndex >= estados.length) order.statusIndex = estados.length - 1;
        localStorage.setItem('orders', JSON.stringify(orders));
        cargarPedidos();
        mostrarPanelEstado(order.statusIndex);
    }

    // --- Panel visual de estado ---
    function mostrarPanelEstado(nivel) {
        const panel = document.getElementById('status-panel');
        panel.classList.remove('hidden');
        const steps = panel.querySelectorAll('.step-dot');
        steps.forEach((dot, i) => {
            dot.className = 'step-dot ' +
                (i < nivel ? 'step-done' :
                    i === nivel ? 'step-active' : 'step-pending');
        });
    }

    // --- Iniciar ---
    document.addEventListener('DOMContentLoaded', cargarPedidos);
</script>
</body>
</html>
